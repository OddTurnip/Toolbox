<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Info - Utilities</title>
    <link rel="icon" type="image/x-icon" href="https://oddturnip.com/favicon_turnip.ico">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* ========================================
           PAGE-SPECIFIC STYLES
           ======================================== */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .info-section {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e0e0e0;
        }

        .info-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            font-size: 1.1em;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            gap: 15px;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
            font-size: 0.9em;
            flex-shrink: 0;
        }

        .info-value {
            color: #333;
            font-weight: 600;
            text-align: right;
            word-break: break-word;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }

        .info-value.live {
            color: #667eea;
        }

        .info-value.success {
            color: #28a745;
        }

        .info-value.warning {
            color: #ffc107;
        }

        .info-value.error {
            color: #dc3545;
        }

        .viewport-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            color: white;
            margin-bottom: 25px;
        }

        .viewport-highlight h2 {
            font-size: 1em;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .viewport-numbers {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .viewport-stat {
            text-align: center;
        }

        .viewport-stat .number {
            font-size: 3em;
            font-weight: 700;
            line-height: 1;
        }

        .viewport-stat .unit {
            font-size: 1.5em;
            opacity: 0.8;
        }

        .viewport-stat .label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }

        .viewport-divider {
            font-size: 2em;
            opacity: 0.5;
        }

        .user-agent-box {
            background: #2d3748;
            color: #a0aec0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85em;
            word-break: break-all;
            line-height: 1.5;
            margin-top: 10px;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 10px;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #5a6fd6;
        }

        .copy-all-section {
            text-align: center;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #e0e0e0;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .loading {
            color: #999;
            font-style: italic;
        }

        .extensions-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .extension-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .extension-tag.detected-modification {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .no-extensions {
            color: #28a745;
            font-weight: 500;
        }

        .fingerprint-hash {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85em;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .badge-live {
            background: rgba(102, 126, 234, 0.15);
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <img src="https://oddturnip.com/img/odd_turnip_480.png" alt="OddTurnip Logo" class="header-logo">
                Browser Info
            </h1>
            <p>See what websites can learn about you</p>
        </header>

        <div class="content">
            <!-- Viewport Highlight -->
            <div class="viewport-highlight">
                <h2>Your Available Viewport <span class="badge badge-live">LIVE</span></h2>
                <div class="viewport-numbers">
                    <div class="viewport-stat">
                        <span class="number" id="viewportWidth">-</span><span class="unit">px</span>
                        <div class="label">Width</div>
                    </div>
                    <div class="viewport-divider">&times;</div>
                    <div class="viewport-stat">
                        <span class="number" id="viewportHeight">-</span><span class="unit">px</span>
                        <div class="label">Height</div>
                    </div>
                </div>
            </div>

            <div class="info-grid">
                <!-- Display Info -->
                <div class="info-section">
                    <h3>Display</h3>
                    <div class="info-row">
                        <span class="info-label">Screen Resolution</span>
                        <span class="info-value" id="screenResolution">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Available Screen</span>
                        <span class="info-value" id="availScreen">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Color Depth</span>
                        <span class="info-value" id="colorDepth">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Pixel Ratio</span>
                        <span class="info-value" id="pixelRatio">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Orientation</span>
                        <span class="info-value live" id="orientation">-</span>
                    </div>
                </div>

                <!-- Browser Info -->
                <div class="info-section">
                    <h3>Browser</h3>
                    <div class="info-row">
                        <span class="info-label">Browser</span>
                        <span class="info-value" id="browserName">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Version</span>
                        <span class="info-value" id="browserVersion">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Engine</span>
                        <span class="info-value" id="browserEngine">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Cookies Enabled</span>
                        <span class="info-value" id="cookiesEnabled">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Do Not Track</span>
                        <span class="info-value" id="doNotTrack">-</span>
                    </div>
                </div>

                <!-- System Info -->
                <div class="info-section">
                    <h3>System</h3>
                    <div class="info-row">
                        <span class="info-label">Operating System</span>
                        <span class="info-value" id="osName">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Platform</span>
                        <span class="info-value" id="platform">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">CPU Cores</span>
                        <span class="info-value" id="cpuCores">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Device Memory</span>
                        <span class="info-value" id="deviceMemory">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Touch Support</span>
                        <span class="info-value" id="touchSupport">-</span>
                    </div>
                </div>

                <!-- Location & Language -->
                <div class="info-section">
                    <h3>Location & Language</h3>
                    <div class="info-row">
                        <span class="info-label">Language</span>
                        <span class="info-value" id="language">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">All Languages</span>
                        <span class="info-value" id="languages">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Timezone</span>
                        <span class="info-value" id="timezone">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">UTC Offset</span>
                        <span class="info-value" id="utcOffset">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Local Time</span>
                        <span class="info-value live" id="localTime">-</span>
                    </div>
                </div>

                <!-- Network -->
                <div class="info-section">
                    <h3>Network</h3>
                    <div class="info-row">
                        <span class="info-label">Online Status</span>
                        <span class="info-value live" id="onlineStatus">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Connection Type</span>
                        <span class="info-value" id="connectionType">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Effective Type</span>
                        <span class="info-value" id="effectiveType">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Downlink</span>
                        <span class="info-value" id="downlink">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Public IP</span>
                        <span class="info-value" id="publicIP"><span class="loading">fetching...</span></span>
                    </div>
                </div>

                <!-- Features -->
                <div class="info-section">
                    <h3>Features & APIs</h3>
                    <div class="info-row">
                        <span class="info-label">JavaScript</span>
                        <span class="info-value success" id="jsEnabled">Enabled</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">WebGL</span>
                        <span class="info-value" id="webglSupport">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">WebRTC</span>
                        <span class="info-value" id="webrtcSupport">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Service Workers</span>
                        <span class="info-value" id="serviceWorkers">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Local Storage</span>
                        <span class="info-value" id="localStorage">-</span>
                    </div>
                </div>

                <!-- User Agent -->
                <div class="info-section full-width">
                    <h3>User Agent <button class="copy-btn" onclick="copyUserAgent()">Copy</button></h3>
                    <div class="user-agent-box" id="userAgent">-</div>
                </div>

                <!-- Fingerprinting -->
                <div class="info-section full-width">
                    <h3>Browser Fingerprinting</h3>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
                        Techniques websites use to identify your browser uniquely, even without cookies.
                    </p>
                    <div class="fingerprint-grid">
                        <div class="info-row">
                            <span class="info-label">Ad Blocker</span>
                            <span class="info-value" id="adBlocker"><span class="loading">checking...</span></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Canvas Fingerprint</span>
                            <span class="info-value" id="canvasFingerprint">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">WebGL Renderer</span>
                            <span class="info-value" id="webglRenderer">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Audio Fingerprint</span>
                            <span class="info-value" id="audioFingerprint">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Installed Fonts</span>
                            <span class="info-value" id="fontsDetected">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Browser Plugins</span>
                            <span class="info-value" id="pluginsCount">-</span>
                        </div>
                    </div>
                </div>

                <!-- Detected Extensions -->
                <div class="info-section full-width">
                    <h3>Detected Extensions & Modifications</h3>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
                        Extensions detected via DOM changes, blocked resources, or web-accessible resources.
                    </p>
                    <div id="extensionsList" class="extensions-list">
                        <span class="loading">scanning...</span>
                    </div>
                </div>
            </div>

            <div class="copy-all-section">
                <button class="btn btn-primary" onclick="copyAllInfo()">Copy All Info to Clipboard</button>
                <div id="copyStatus" class="status"></div>
            </div>

            <div class="info-box">
                <h4>About This Tool</h4>
                <p>This page shows information that any website you visit can see about your browser and device.
                   This is useful for troubleshooting, sharing your setup with support, or simply understanding your digital footprint.
                   The viewport size updates live as you resize your window.</p>
            </div>
        </div>

        <div class="footer">
            <div class="footer-links">
                <a href="index.html">&larr; Back to Utilities</a>
                <a href="https://www.oddturnip.com" target="_blank" class="oddturnip-link">
                    <img src="https://oddturnip.com/img/odd_turnip_48.png" alt="OddTurnip Logo">
                    <span>Created by OddTurnip.com</span>
                </a>
            </div>
        </div>
    </div>

    <script>
        /* ========================================
           BROWSER INFO DETECTION
           ======================================== */

        // Update viewport dimensions (live)
        function updateViewport() {
            document.getElementById('viewportWidth').textContent = window.innerWidth;
            document.getElementById('viewportHeight').textContent = window.innerHeight;
        }

        // Update orientation
        function updateOrientation() {
            const orientation = screen.orientation?.type ||
                (window.innerWidth > window.innerHeight ? 'landscape' : 'portrait');
            document.getElementById('orientation').textContent =
                orientation.includes('landscape') ? 'Landscape' : 'Portrait';
        }

        // Update online status
        function updateOnlineStatus() {
            const el = document.getElementById('onlineStatus');
            if (navigator.onLine) {
                el.textContent = 'Online';
                el.className = 'info-value live success';
            } else {
                el.textContent = 'Offline';
                el.className = 'info-value live error';
            }
        }

        // Update local time
        function updateLocalTime() {
            document.getElementById('localTime').textContent =
                new Date().toLocaleTimeString();
        }

        // Parse User Agent for browser info
        function getBrowserInfo() {
            const ua = navigator.userAgent;
            let browser = 'Unknown';
            let version = 'Unknown';
            let engine = 'Unknown';

            if (ua.includes('Firefox/')) {
                browser = 'Firefox';
                version = ua.match(/Firefox\/([\d.]+)/)?.[1] || 'Unknown';
                engine = 'Gecko';
            } else if (ua.includes('Edg/')) {
                browser = 'Microsoft Edge';
                version = ua.match(/Edg\/([\d.]+)/)?.[1] || 'Unknown';
                engine = 'Blink';
            } else if (ua.includes('Chrome/')) {
                browser = 'Chrome';
                version = ua.match(/Chrome\/([\d.]+)/)?.[1] || 'Unknown';
                engine = 'Blink';
            } else if (ua.includes('Safari/') && !ua.includes('Chrome')) {
                browser = 'Safari';
                version = ua.match(/Version\/([\d.]+)/)?.[1] || 'Unknown';
                engine = 'WebKit';
            } else if (ua.includes('Opera') || ua.includes('OPR/')) {
                browser = 'Opera';
                version = ua.match(/(?:Opera|OPR)\/([\d.]+)/)?.[1] || 'Unknown';
                engine = 'Blink';
            }

            return { browser, version, engine };
        }

        // Parse OS from User Agent
        function getOSInfo() {
            const ua = navigator.userAgent;

            if (ua.includes('Windows NT 10.0')) return 'Windows 10/11';
            if (ua.includes('Windows NT 6.3')) return 'Windows 8.1';
            if (ua.includes('Windows NT 6.2')) return 'Windows 8';
            if (ua.includes('Windows NT 6.1')) return 'Windows 7';
            if (ua.includes('Mac OS X')) {
                const match = ua.match(/Mac OS X ([\d_]+)/);
                if (match) return 'macOS ' + match[1].replace(/_/g, '.');
                return 'macOS';
            }
            if (ua.includes('Android')) {
                const match = ua.match(/Android ([\d.]+)/);
                return match ? 'Android ' + match[1] : 'Android';
            }
            if (ua.includes('iPhone') || ua.includes('iPad')) {
                const match = ua.match(/OS ([\d_]+)/);
                return match ? 'iOS ' + match[1].replace(/_/g, '.') : 'iOS';
            }
            if (ua.includes('Linux')) return 'Linux';
            if (ua.includes('CrOS')) return 'Chrome OS';

            return 'Unknown';
        }

        // Check WebGL support
        function checkWebGL() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    if (debugInfo) {
                        return gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                    }
                    return 'Supported';
                }
                return 'Not supported';
            } catch (e) {
                return 'Not supported';
            }
        }

        // Fetch public IP
        async function fetchPublicIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                document.getElementById('publicIP').textContent = data.ip;
            } catch (e) {
                document.getElementById('publicIP').textContent = 'Unable to fetch';
                document.getElementById('publicIP').className = 'info-value warning';
            }
        }

        // Initialize all info
        function initializeInfo() {
            // Viewport (live)
            updateViewport();
            window.addEventListener('resize', () => {
                updateViewport();
                updateOrientation();
            });

            // Screen info
            document.getElementById('screenResolution').textContent =
                `${screen.width} × ${screen.height} px`;
            document.getElementById('availScreen').textContent =
                `${screen.availWidth} × ${screen.availHeight} px`;
            document.getElementById('colorDepth').textContent =
                `${screen.colorDepth}-bit`;
            document.getElementById('pixelRatio').textContent =
                `${window.devicePixelRatio}x`;
            updateOrientation();

            // Browser info
            const browserInfo = getBrowserInfo();
            document.getElementById('browserName').textContent = browserInfo.browser;
            document.getElementById('browserVersion').textContent = browserInfo.version;
            document.getElementById('browserEngine').textContent = browserInfo.engine;
            document.getElementById('cookiesEnabled').textContent =
                navigator.cookieEnabled ? 'Yes' : 'No';
            document.getElementById('cookiesEnabled').className =
                'info-value ' + (navigator.cookieEnabled ? 'success' : 'error');

            const dnt = navigator.doNotTrack;
            document.getElementById('doNotTrack').textContent =
                dnt === '1' ? 'Enabled' : dnt === '0' ? 'Disabled' : 'Not set';

            // System info
            document.getElementById('osName').textContent = getOSInfo();
            document.getElementById('platform').textContent =
                navigator.platform || 'Unknown';
            document.getElementById('cpuCores').textContent =
                navigator.hardwareConcurrency || 'Unknown';
            setInfoValue('deviceMemory', navigator.deviceMemory ? `${navigator.deviceMemory} GB` : null);
            document.getElementById('touchSupport').textContent =
                ('ontouchstart' in window || navigator.maxTouchPoints > 0)
                    ? `Yes (${navigator.maxTouchPoints || 1} points)` : 'No';

            // Location & Language
            document.getElementById('language').textContent =
                navigator.language || 'Unknown';
            document.getElementById('languages').textContent =
                navigator.languages?.join(', ') || navigator.language || 'Unknown';
            document.getElementById('timezone').textContent =
                Intl.DateTimeFormat().resolvedOptions().timeZone || 'Unknown';

            const offset = -new Date().getTimezoneOffset();
            const hours = Math.floor(Math.abs(offset) / 60);
            const mins = Math.abs(offset) % 60;
            document.getElementById('utcOffset').textContent =
                `UTC${offset >= 0 ? '+' : '-'}${hours}:${mins.toString().padStart(2, '0')}`;

            updateLocalTime();
            setInterval(updateLocalTime, 1000);

            // Network
            updateOnlineStatus();
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);

            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            if (connection) {
                setInfoValue('connectionType', connection.type);
                setInfoValue('effectiveType', connection.effectiveType?.toUpperCase());
                setInfoValue('downlink', connection.downlink ? `${connection.downlink} Mbps` : null);
            } else {
                // Hide all connection rows if API not available
                setInfoValue('connectionType', null);
                setInfoValue('effectiveType', null);
                setInfoValue('downlink', null);
            }

            fetchPublicIP();

            // Features
            const webgl = checkWebGL();
            document.getElementById('webglSupport').textContent =
                webgl.length > 20 ? 'Supported' : webgl;
            document.getElementById('webglSupport').className =
                'info-value ' + (webgl !== 'Not supported' ? 'success' : 'error');

            document.getElementById('webrtcSupport').textContent =
                (window.RTCPeerConnection || window.webkitRTCPeerConnection) ? 'Supported' : 'Not supported';
            document.getElementById('webrtcSupport').className =
                'info-value ' + ((window.RTCPeerConnection || window.webkitRTCPeerConnection) ? 'success' : 'error');

            document.getElementById('serviceWorkers').textContent =
                'serviceWorker' in navigator ? 'Supported' : 'Not supported';
            document.getElementById('serviceWorkers').className =
                'info-value ' + ('serviceWorker' in navigator ? 'success' : 'error');

            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                document.getElementById('localStorage').textContent = 'Available';
                document.getElementById('localStorage').className = 'info-value success';
            } catch (e) {
                document.getElementById('localStorage').textContent = 'Blocked';
                document.getElementById('localStorage').className = 'info-value error';
            }

            // User Agent
            document.getElementById('userAgent').textContent = navigator.userAgent;

            // Fingerprinting & Extensions
            runFingerprintTests();
            detectExtensions();
        }

        // ========================================
        // FINGERPRINTING DETECTION
        // ========================================

        // Simple hash function for fingerprints
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(16).padStart(8, '0');
        }

        // Canvas fingerprint
        function getCanvasFingerprint() {
            try {
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 50;
                const ctx = canvas.getContext('2d');

                // Draw text with various styles
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillStyle = '#f60';
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = '#069';
                ctx.fillText('Fingerprint', 2, 15);
                ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
                ctx.fillText('Canvas', 4, 17);

                const dataUrl = canvas.toDataURL();
                return simpleHash(dataUrl);
            } catch (e) {
                return 'blocked';
            }
        }

        // WebGL renderer info
        function getWebGLRenderer() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    if (debugInfo) {
                        const vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
                        const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                        return `${vendor} - ${renderer}`;
                    }
                    return 'Available (masked)';
                }
                return 'Not available';
            } catch (e) {
                return 'Blocked';
            }
        }

        // Audio fingerprint
        function getAudioFingerprint() {
            return new Promise((resolve) => {
                try {
                    const AudioContext = window.OfflineAudioContext || window.webkitOfflineAudioContext;
                    if (!AudioContext) {
                        resolve('Not supported');
                        return;
                    }

                    const context = new AudioContext(1, 44100, 44100);
                    const oscillator = context.createOscillator();
                    oscillator.type = 'triangle';
                    oscillator.frequency.setValueAtTime(10000, context.currentTime);

                    const compressor = context.createDynamicsCompressor();
                    compressor.threshold.setValueAtTime(-50, context.currentTime);
                    compressor.knee.setValueAtTime(40, context.currentTime);
                    compressor.ratio.setValueAtTime(12, context.currentTime);
                    compressor.attack.setValueAtTime(0, context.currentTime);
                    compressor.release.setValueAtTime(0.25, context.currentTime);

                    oscillator.connect(compressor);
                    compressor.connect(context.destination);
                    oscillator.start(0);

                    context.startRendering().then((buffer) => {
                        const data = buffer.getChannelData(0);
                        let sum = 0;
                        for (let i = 4500; i < 5000; i++) {
                            sum += Math.abs(data[i]);
                        }
                        resolve(simpleHash(sum.toString()));
                    }).catch(() => resolve('Blocked'));
                } catch (e) {
                    resolve('Blocked');
                }
            });
        }

        // Font detection
        function detectFonts() {
            const baseFonts = ['monospace', 'sans-serif', 'serif'];
            const testFonts = [
                'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 'Georgia',
                'Impact', 'Lucida Console', 'Palatino Linotype', 'Tahoma', 'Times New Roman',
                'Trebuchet MS', 'Verdana', 'Consolas', 'Monaco', 'Segoe UI',
                'Helvetica', 'Roboto', 'Open Sans', 'Ubuntu', 'Calibri'
            ];

            const testString = 'mmmmmmmmmmlli';
            const testSize = '72px';
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            const getWidth = (fontFamily) => {
                ctx.font = `${testSize} ${fontFamily}`;
                return ctx.measureText(testString).width;
            };

            const baseWidths = {};
            baseFonts.forEach(font => {
                baseWidths[font] = getWidth(font);
            });

            const detected = testFonts.filter(font => {
                return baseFonts.some(baseFont => {
                    return getWidth(`'${font}', ${baseFont}`) !== baseWidths[baseFont];
                });
            });

            return detected;
        }

        // Ad blocker detection
        function detectAdBlocker() {
            return new Promise((resolve) => {
                // Create a bait element
                const bait = document.createElement('div');
                bait.className = 'ad ads adsbox ad-placement doubleclick';
                bait.style.cssText = 'position:absolute;top:-10px;left:-10px;width:1px;height:1px;';
                bait.innerHTML = '&nbsp;';
                document.body.appendChild(bait);

                setTimeout(() => {
                    const blocked = bait.offsetHeight === 0 ||
                                   bait.offsetParent === null ||
                                   window.getComputedStyle(bait).display === 'none';
                    bait.remove();
                    resolve(blocked);
                }, 100);
            });
        }

        // Run all fingerprint tests
        async function runFingerprintTests() {
            // Ad blocker
            const hasAdBlocker = await detectAdBlocker();
            const adBlockEl = document.getElementById('adBlocker');
            adBlockEl.textContent = hasAdBlocker ? 'Detected' : 'Not detected';
            adBlockEl.className = 'info-value ' + (hasAdBlocker ? 'warning' : 'success');

            // Canvas fingerprint
            const canvasFp = getCanvasFingerprint();
            document.getElementById('canvasFingerprint').innerHTML =
                `<span class="fingerprint-hash">${canvasFp}</span>`;

            // WebGL renderer
            const webglRenderer = getWebGLRenderer();
            document.getElementById('webglRenderer').textContent = webglRenderer;

            // Audio fingerprint
            const audioFp = await getAudioFingerprint();
            document.getElementById('audioFingerprint').innerHTML =
                `<span class="fingerprint-hash">${audioFp}</span>`;

            // Fonts
            const fonts = detectFonts();
            document.getElementById('fontsDetected').textContent = `${fonts.length} detected`;

            // Plugins
            const plugins = navigator.plugins?.length || 0;
            document.getElementById('pluginsCount').textContent =
                plugins > 0 ? `${plugins} plugins` : 'None / Hidden';
        }

        // ========================================
        // EXTENSION DETECTION
        // ========================================

        async function detectExtensions() {
            const detected = [];

            // Check for common extension modifications

            // 1. Grammarly
            if (document.querySelector('[data-grammarly-extension]') ||
                document.querySelector('grammarly-extension') ||
                window.hasOwnProperty('__grammarly')) {
                detected.push({ name: 'Grammarly', type: 'dom' });
            }

            // 2. LastPass
            if (document.querySelector('[data-lastpass-root]') ||
                document.querySelector('div[id^="__lastpass"]')) {
                detected.push({ name: 'LastPass', type: 'dom' });
            }

            // 3. Honey
            if (document.querySelector('[id*="honey"]') ||
                window.hasOwnProperty('HoneyGetCodes')) {
                detected.push({ name: 'Honey', type: 'dom' });
            }

            // 4. React DevTools
            if (window.hasOwnProperty('__REACT_DEVTOOLS_GLOBAL_HOOK__')) {
                detected.push({ name: 'React DevTools', type: 'dom' });
            }

            // 5. Redux DevTools
            if (window.hasOwnProperty('__REDUX_DEVTOOLS_EXTENSION__')) {
                detected.push({ name: 'Redux DevTools', type: 'dom' });
            }

            // 6. Vue DevTools
            if (window.hasOwnProperty('__VUE_DEVTOOLS_GLOBAL_HOOK__')) {
                detected.push({ name: 'Vue DevTools', type: 'dom' });
            }

            // 7. Dark Reader
            if (document.querySelector('style.darkreader') ||
                document.querySelector('meta[name="darkreader"]')) {
                detected.push({ name: 'Dark Reader', type: 'dom' });
            }

            // 8. Bitwarden
            if (document.querySelector('[data-bwautofill]')) {
                detected.push({ name: 'Bitwarden', type: 'dom' });
            }

            // 9. 1Password
            if (document.querySelector('[data-onepassword-extension]') ||
                document.querySelector('com-1password-button')) {
                detected.push({ name: '1Password', type: 'dom' });
            }

            // 10. uBlock Origin (via blocked bait)
            const hasAdBlocker = await detectAdBlocker();
            if (hasAdBlocker) {
                detected.push({ name: 'Ad Blocker (uBlock/AdBlock/etc)', type: 'behavior' });
            }

            // 11. Ghostery
            if (window.hasOwnProperty('__GHOSTERY__')) {
                detected.push({ name: 'Ghostery', type: 'dom' });
            }

            // 12. Tampermonkey/Greasemonkey
            if (window.hasOwnProperty('GM_info') || window.hasOwnProperty('GM')) {
                detected.push({ name: 'Userscript Manager', type: 'dom' });
            }

            // 13. Privacy Badger
            if (document.querySelector('[data-privacy-badger]')) {
                detected.push({ name: 'Privacy Badger', type: 'dom' });
            }

            // Display results
            const listEl = document.getElementById('extensionsList');
            if (detected.length === 0) {
                listEl.innerHTML = '<span class="no-extensions">No extensions detected (or they\'re well-hidden!)</span>';
            } else {
                listEl.innerHTML = detected.map(ext =>
                    `<span class="extension-tag ${ext.type === 'behavior' ? 'detected-modification' : ''}">${ext.name}</span>`
                ).join('');
            }
        }

        // Copy functions
        function copyUserAgent() {
            navigator.clipboard.writeText(navigator.userAgent).then(() => {
                showStatus(document.getElementById('copyStatus'), 'User Agent copied!');
            });
        }

        function copyAllInfo() {
            const info = gatherAllInfo();
            navigator.clipboard.writeText(info).then(() => {
                showStatus(document.getElementById('copyStatus'), 'All info copied to clipboard!');
            }).catch(() => {
                showStatus(document.getElementById('copyStatus'), 'Failed to copy', 'error');
            });
        }

        function gatherAllInfo() {
            const browserInfo = getBrowserInfo();
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;

            return `=== Browser Info ===
Generated: ${new Date().toISOString()}

VIEWPORT
  Width: ${window.innerWidth}px
  Height: ${window.innerHeight}px

DISPLAY
  Screen Resolution: ${screen.width} × ${screen.height}px
  Available Screen: ${screen.availWidth} × ${screen.availHeight}px
  Color Depth: ${screen.colorDepth}-bit
  Pixel Ratio: ${window.devicePixelRatio}x

BROWSER
  Browser: ${browserInfo.browser}
  Version: ${browserInfo.version}
  Engine: ${browserInfo.engine}
  Cookies: ${navigator.cookieEnabled ? 'Enabled' : 'Disabled'}
  Do Not Track: ${navigator.doNotTrack === '1' ? 'Enabled' : navigator.doNotTrack === '0' ? 'Disabled' : 'Not set'}

SYSTEM
  OS: ${getOSInfo()}
  Platform: ${navigator.platform}
  CPU Cores: ${navigator.hardwareConcurrency || 'Unknown'}
  Device Memory: ${navigator.deviceMemory ? navigator.deviceMemory + ' GB' : 'Not available'}
  Touch: ${('ontouchstart' in window || navigator.maxTouchPoints > 0) ? 'Yes' : 'No'}

LOCATION & LANGUAGE
  Language: ${navigator.language}
  All Languages: ${navigator.languages?.join(', ') || navigator.language}
  Timezone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}

NETWORK
  Online: ${navigator.onLine ? 'Yes' : 'No'}
  Connection: ${connection?.effectiveType?.toUpperCase() || 'Unknown'}
  Public IP: ${document.getElementById('publicIP').textContent}

USER AGENT
${navigator.userAgent}
`;
        }

        // Utility function: set value or hide row if unavailable
        function setInfoValue(id, value, className = '') {
            const el = document.getElementById(id);
            if (!value || value === 'Unknown' || value === 'Not available') {
                // Hide the entire row
                el.closest('.info-row').style.display = 'none';
                return false;
            }
            el.textContent = value;
            if (className) el.className = 'info-value ' + className;
            return true;
        }

        // Utility function
        function showStatus(element, message, type = 'success') {
            element.textContent = message;
            element.className = 'status ' + type;
            if (type === 'success') {
                setTimeout(() => {
                    element.className = 'status';
                }, 2000);
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initializeInfo);
    </script>
</body>
</html>
